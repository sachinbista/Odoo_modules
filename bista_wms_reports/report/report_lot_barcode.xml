<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_lot_label_inherit" inherit_id="stock.report_lot_label">

        <xpath expr="//td" position="replace">
            <td t-att-style="barcode_index &gt;= len(page_docs) and 'visibility:hidden'">

                <t t-set="use_qr_code" t-value="request.env['ir.config_parameter'].sudo().get_param('bista_wms_reports.use_qr_code_print_label')"/>

                <div t-att-style="'position:relative; width:43mm; height:19mm; border: 1px solid %s;' % (o.env.user.company_id.primary_color or 'black')">
                    <t t-set="final_barcode" t-value="''"/>
                    <t t-if="env.user.has_group('stock.group_stock_lot_print_gs1')">
                        <t t-if="o.product_id.valid_ean" t-set="final_barcode" t-value="'01' + '0' * (14 - len(o.product_id.barcode)) + o.product_id.barcode"/>
                        <t name="gs1_datamatrix_lot" t-if="o.product_id.tracking == 'lot'" t-set="final_barcode" t-value="(final_barcode or '') + '10' + o.name"/>
                        <t t-elif="o.product_id.tracking == 'serial'" t-set="final_barcode" t-value="(final_barcode or '') + '21' + o.name"/>
                    </t>

                    <t t-if="use_qr_code">
                        <div class="row">
                            <div class="col-7">
                                <div class="o_label_4x12" t-field="o.product_id.display_name"
                                     t-att-style="'width:22mm' if final_barcode else ''"/>
                                <div class="o_label_4x12" name="lot_name" t-field="o.name"
                                     t-att-style="'width:22mm' if final_barcode else ''"/>
                                <t t-if="o.use_expiration_date">
                                    <div class="o_label_4x12" t-if="o.use_date">
                                        B.b.
                                        <t t-out="o.use_date" t-options='{"widget": "date"}'/>
                                    </div>
                                    <div class="o_label_4x12" t-if="o.expiration_date">
                                        Exp.
                                        <t t-out="o.expiration_date" t-options='{"widget": "date"}'/>
                                    </div>
                                </t>
                            </div>
                            <div class="col-5">
                                <img t-att-src="'/report/barcode/?barcode_type=QR&amp;value=%s&amp;width=60&amp;height=60&amp;humanreadable=1' % o.name"/>
                            </div>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="o_label_4x12" t-field="o.product_id.display_name"
                             t-att-style="'width:22mm' if final_barcode else ''"/>
                    </t>

                    <t t-if="use_qr_code">
                        <div/>
                    </t>
                    <t t-else="">
                        <div class="o_label_4x12" name="lot_name" t-field="o.name"
                             t-att-style="'width:22mm' if final_barcode else ''"/>

                        <t t-if="o.use_expiration_date">
                            <div class="o_label_4x12" t-if="o.use_date">
                                B.b. <t t-out="o.use_date" t-options='{"widget": "date"}'/>
                            </div>
                            <div class="o_label_4x12" t-if="o.expiration_date">
                                Exp. <t t-out="o.expiration_date" t-options='{"widget": "date"}'/>
                            </div>
                        </t>
                    </t>

                    <t t-if="env.user.has_group('stock.group_stock_lot_print_gs1')">
                        <div t-if="final_barcode" t-att-style="'position:absolute; right:.5px; bottom:.5px'" t-out="final_barcode" t-options="{'widget': 'barcode', 'symbology': 'ECC200DataMatrix', 'img_style': 'width:17mm; height:17mm'}"/>
                    </t>

                    <t t-if="use_qr_code">
                        <div/>
                    </t>
                    <t t-else="">
                        <div t-field="o.name" t-options="{'widget': 'barcode', 'img_style': 'width:100%; height:35%'}"/>
                    </t>

                </div>
            </td>
        </xpath>

    </template>
</odoo>